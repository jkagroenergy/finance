<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tax Forecasting | FinCent</title>
    <script src="../../js/common.js"></script>
    <script src="../../numberToWords.js"></script>

    <style>
        :root {
            /* Revised purple color scheme from index.html */
            --brand-purple-1: #5b3bd6; /* deep */
            --brand-purple-2: #7b5cf2; /* mid */
            --brand-purple-3: #8b6ff8; /* light */
            --accent-green: #1fc08b;

            /* Semantic aliases */
            --primary: var(--brand-purple-2);
            --primary-light: var(--brand-purple-3);
            --primary-dark: var(--brand-purple-1);
            --secondary: #0f172a;
            --success: #10b981;
            --danger: #dc2626;
            --warning: #f59e0b;
            --light: #f8fafc;
            --card: #ffffff;
            --font-scale: 0.95;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", sans-serif;
        }

        body {
            background: var(--light);
            color: var(--secondary);
            padding: 30px;
        }

        .page-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header h1 {
            font-size: calc(28px * var(--font-scale));
            color: var(--primary);
            margin: 0;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: var(--secondary);
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        .fy-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .fy-selector label {
            font-weight: 600;
            color: var(--secondary);
            white-space: nowrap;
        }

        .fy-selector select {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            min-width: 180px;
            background: white;
            color: var(--secondary);
        }

        .tabs {
            display: flex;
            gap: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            font-size: calc(14px * var(--font-scale));
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -15px;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .stat-card h4 {
            font-size: calc(12px * var(--font-scale));
            color: #64748b;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: calc(20px * var(--font-scale));
            font-weight: bold;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: calc(14px * var(--font-scale));
            font-family: inherit;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        .card h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: calc(18px * var(--font-scale));
        }

        .income-sources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .income-source-box {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .income-source-box h4 {
            font-size: calc(15px * var(--font-scale));
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .income-source-box .value {
            font-size: calc(18px * var(--font-scale));
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .income-source-box .note {
            font-size: calc(11px * var(--font-scale));
            color: #64748b;
            font-style: italic;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .btn-group button {
            flex: 1;
        }

        .deduction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            background: white;
        }

        .deduction-item:last-child {
            border-bottom: none;
        }

        .deduction-label {
            font-weight: 600;
            color: var(--secondary);
        }

        .deduction-amount {
            font-size: calc(15px * var(--font-scale));
            font-weight: bold;
            color: var(--primary);
        }

        .tax-bracket {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            margin-bottom: 15px;
        }

        .tax-bracket-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .tax-bracket-label {
            font-weight: 600;
            color: var(--secondary);
        }

        .tax-bracket-value {
            color: var(--primary);
            font-weight: bold;
        }

        .advance-tax-schedule {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .advance-tax-schedule th {
            background: #f1f5f9;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
        }

        .advance-tax-schedule td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .highlight {
            background: #fef3c7;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--warning);
            margin-bottom: 15px;
        }

        .highlight h4 {
            color: var(--warning);
            font-weight: 700;
            margin-bottom: 8px;
        }

        @media (max-width: 1024px) {
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row,
            .form-row-3 {
                grid-template-columns: 1fr;
            }

            .income-sources-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Breadcrumb Styling */
        .entity-breadcrumb { background: linear-gradient(135deg, #f0f4ff 0%, #f5f3ff 100%); border: 1px solid #e0d8f5; border-radius: 8px; padding: 12px 16px; margin-bottom: 25px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; width: 100%; box-sizing: border-box; }
        .breadcrumb-label { font-size: 13px; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }
        .breadcrumb-entity-name { font-size: 16px; font-weight: 700; color: var(--primary); }
        .breadcrumb-entity-type { background: #e9e5ff; color: #6d28d9; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
    </style>
</head>

<body>
    <div class="page-header">
        <h1>Tax Forecasting for Financial Year</h1>
    </div>

    <div class="fy-selector">
        <label for="fyDropdown">Financial Year:</label>
        <select id="fyDropdown" onchange="onFYChange()">
            <option value="">-- Select Financial Year --</option>
            <option value="2025-26" selected>2025-26</option>
            <option value="2024-25">2024-25</option>
            <option value="2023-24">2023-24</option>
            <option value="2022-23">2022-23</option>
        </select>
    </div>

    <div class="summary-stats" id="summaryStats"></div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('income-sources')">Income Sources</button>
        <button class="tab-btn" onclick="switchTab('deductions')">Deductions</button>
        <button class="tab-btn" onclick="switchTab('tax-calculation')">Tax Calculation</button>
        <button class="tab-btn" onclick="switchTab('advance-tax')">Advance Tax Schedule</button>
    </div>

    <!-- Income Sources Tab -->
    <div class="tab-content active" id="income-sources">
        <div class="card">
            <h3>üìä Income Sources Projection</h3>
            <p style="color: #64748b; margin-bottom: 20px;">Pull income data from your income details or enter custom projections for the financial year.</p>
            
            <div class="form-row-3">
                <div class="form-group">
                    <label for="salaryIncome">Salary Income (‚Çπ)</label>
                    <input type="number" id="salaryIncome" placeholder="Annual salary" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
                <div class="form-group">
                    <label for="rentalIncome">Rental Income (‚Çπ)</label>
                    <input type="number" id="rentalIncome" placeholder="Annual rental" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
                <div class="form-group">
                    <label for="interestIncome">Interest Income (‚Çπ)</label>
                    <input type="number" id="interestIncome" placeholder="Annual interest" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
            </div>

            <div class="form-row-3">
                <div class="form-group">
                    <label for="dividendIncome">Dividend Income (‚Çπ)</label>
                    <input type="number" id="dividendIncome" placeholder="Annual dividend" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
                <div class="form-group">
                    <label for="capitalGains">Capital Gains (‚Çπ)</label>
                    <input type="number" id="capitalGains" placeholder="Annual capital gains" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
                <div class="form-group">
                    <label for="otherIncome">Other Income (‚Çπ)</label>
                    <input type="number" id="otherIncome" placeholder="Other sources" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
            </div>

            <button class="btn btn-primary" onclick="pullFromIncomeModule()">üì• Pull from Income Module</button>
            <button class="btn btn-secondary" onclick="saveIncomeProjection()" style="margin-left: 10px;">üíæ Save Projection</button>
        </div>
    </div>

    <!-- Deductions Tab -->
    <div class="tab-content" id="deductions">
        <div class="card">
            <h3>üè∑Ô∏è Tax Deductions & Exemptions</h3>
            <p style="color: #64748b; margin-bottom: 20px;">Enter your planned deductions for the financial year.</p>
            
            <div class="form-row-3">
                <div class="form-group">
                    <label for="section80C">Section 80C (Life Insurance, EPF, etc.) (‚Çπ)</label>
                    <input type="number" id="section80C" placeholder="Max ‚Çπ 1,50,000" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
                <div class="form-group">
                    <label for="section80D">Section 80D (Medical Insurance) (‚Çπ)</label>
                    <input type="number" id="section80D" placeholder="Max ‚Çπ 1,00,000" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
                <div class="form-group">
                    <label for="section80E">Section 80E (Education Loan) (‚Çπ)</label>
                    <input type="number" id="section80E" placeholder="No limit" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
            </div>

            <div class="form-row-3">
                <div class="form-group">
                    <label for="section24">Section 24 (Home Loan Interest) (‚Çπ)</label>
                    <input type="number" id="section24" placeholder="Max ‚Çπ 2,00,000" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
                <div class="form-group">
                    <label for="section80TTA">Section 80TTA (Savings Interest) (‚Çπ)</label>
                    <input type="number" id="section80TTA" placeholder="Max ‚Çπ 10,000" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
                <div class="form-group">
                    <label for="otherDeductions">Other Deductions (‚Çπ)</label>
                    <input type="number" id="otherDeductions" placeholder="Other eligible deductions" min="0" step="100" onchange="updateTaxCalculation()" />
                </div>
            </div>

            <div class="card" style="background: #f0f9ff; margin-top: 20px;">
                <h4 style="color: var(--primary);">Total Deductions: <span id="totalDeductions">‚Çπ 0</span></h4>
            </div>

            <button class="btn btn-primary" onclick="saveDeductions()" style="margin-top: 20px;">üíæ Save Deductions</button>
        </div>
    </div>

    <!-- Tax Calculation Tab -->
    <div class="tab-content" id="tax-calculation">
        <div class="card">
            <h3>üí∞ Projected Tax Calculation</h3>

            <div class="highlight">
                <h4>‚ö†Ô∏è Advance Tax Recommendation</h4>
                <p id="advanceTaxAdvice" style="color: #92400e; font-size: calc(14px * var(--font-scale));">
                    No income projected yet. Enter income and deductions to get advance tax recommendations.
                </p>
            </div>

            <div class="tax-bracket">
                <div class="tax-bracket-item">
                    <span class="tax-bracket-label">Gross Income:</span>
                    <span class="tax-bracket-value" id="grossIncome">‚Çπ 0</span>
                </div>
                <div class="tax-bracket-item">
                    <span class="tax-bracket-label">Total Deductions:</span>
                    <span class="tax-bracket-value" id="totalDeductionsDisplay">‚Çπ 0</span>
                </div>
                <div class="tax-bracket-item" style="border-top: 2px solid #dbeafe; padding-top: 12px; margin-top: 12px;">
                    <span class="tax-bracket-label" style="font-size: larger;">Taxable Income:</span>
                    <span class="tax-bracket-value" style="font-size: larger;" id="taxableIncome">‚Çπ 0</span>
                </div>
            </div>

            <div class="tax-bracket" style="background: #f0fdf4; border-left-color: var(--success);">
                <div class="tax-bracket-item">
                    <span class="tax-bracket-label">Tax on Income:</span>
                    <span class="tax-bracket-value" style="color: var(--success);" id="taxOnIncome">‚Çπ 0</span>
                </div>
                <div class="tax-bracket-item">
                    <span class="tax-bracket-label">Health and Education Cess (4%):</span>
                    <span class="tax-bracket-value" style="color: var(--success);" id="healthCess">‚Çπ 0</span>
                </div>
                <div class="tax-bracket-item" style="border-top: 2px solid #dcfce7; padding-top: 12px; margin-top: 12px;">
                    <span class="tax-bracket-label" style="font-size: larger; color: var(--success);">Total Tax Liability:</span>
                    <span class="tax-bracket-value" style="color: var(--success); font-size: larger;" id="totalTaxLiability">‚Çπ 0</span>
                </div>
            </div>

            <button class="btn btn-primary" onclick="saveTaxCalculation()" style="margin-top: 20px;">üíæ Save Projection</button>
        </div>
    </div>

    <!-- Advance Tax Schedule Tab -->
    <div class="tab-content" id="advance-tax">
        <div class="card">
            <h3>üìÖ Advance Tax Payment Schedule</h3>
            <p style="color: #64748b; margin-bottom: 20px;">Recommended advance tax payments for the financial year based on your projected income and tax liability.</p>

            <table class="advance-tax-schedule">
                <thead>
                    <tr>
                        <th>Installment</th>
                        <th>Due Date</th>
                        <th>% of Total Tax</th>
                        <th>Amount (‚Çπ)</th>
                        <th>Cumulative (‚Çπ)</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="advanceTaxSchedule">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px; color: #94a3b8;">
                            Enter income and deductions above to generate advance tax schedule
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="highlight" style="margin-top: 20px;">
                <h4>üìù Payment Instructions</h4>
                <p style="color: #92400e; font-size: calc(13px * var(--font-scale)); line-height: 1.6;">
                    ‚Ä¢ Pay advance tax using challan 280<br/>
                    ‚Ä¢ Penalties apply if paid late or insufficient advance tax<br/>
                    ‚Ä¢ Interest at 1% per month on shortfall<br/>
                    ‚Ä¢ Balance due at filing can be paid with ITR
                </p>
            </div>
        </div>
    </div>

    <script>
        let currentFY = '2025-26';

        function onFYChange() {
            currentFY = document.getElementById('fyDropdown').value;
            loadProjectionData();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function pullFromIncomeModule() {
            // This would fetch from income-details localStorage
            const incomeData = JSON.parse(localStorage.getItem('incomeDetails') || '{}');
            if (incomeData.salary) document.getElementById('salaryIncome').value = incomeData.salary || '';
            if (incomeData.rental) document.getElementById('rentalIncome').value = incomeData.rental || '';
            if (incomeData.interest) document.getElementById('interestIncome').value = incomeData.interest || '';
            if (incomeData.dividend) document.getElementById('dividendIncome').value = incomeData.dividend || '';
            updateTaxCalculation();
        }

        function updateTaxCalculation() {
            const salary = parseFloat(document.getElementById('salaryIncome').value) || 0;
            const rental = parseFloat(document.getElementById('rentalIncome').value) || 0;
            const interest = parseFloat(document.getElementById('interestIncome').value) || 0;
            const dividend = parseFloat(document.getElementById('dividendIncome').value) || 0;
            const capitalGains = parseFloat(document.getElementById('capitalGains').value) || 0;
            const otherIncome = parseFloat(document.getElementById('otherIncome').value) || 0;

            const section80C = parseFloat(document.getElementById('section80C').value) || 0;
            const section80D = parseFloat(document.getElementById('section80D').value) || 0;
            const section80E = parseFloat(document.getElementById('section80E').value) || 0;
            const section24 = parseFloat(document.getElementById('section24').value) || 0;
            const section80TTA = parseFloat(document.getElementById('section80TTA').value) || 0;
            const otherDeductions = parseFloat(document.getElementById('otherDeductions').value) || 0;

            const grossIncome = salary + rental + interest + dividend + capitalGains + otherIncome;
            const totalDeductions = section80C + section80D + section80E + section24 + section80TTA + otherDeductions;
            const taxableIncome = Math.max(0, grossIncome - totalDeductions);

            // FY 2025-26 tax slabs
            let taxOnIncome = 0;
            if (taxableIncome <= 300000) {
                taxOnIncome = 0;
            } else if (taxableIncome <= 700000) {
                taxOnIncome = (taxableIncome - 300000) * 0.05;
            } else if (taxableIncome <= 1000000) {
                taxOnIncome = 20000 + (taxableIncome - 700000) * 0.20;
            } else if (taxableIncome <= 1200000) {
                taxOnIncome = 20000 + 60000 + (taxableIncome - 1000000) * 0.30;
            } else {
                taxOnIncome = 20000 + 60000 + 60000 + (taxableIncome - 1200000) * 0.30;
            }

            const healthCess = taxOnIncome * 0.04;
            const totalTax = taxOnIncome + healthCess;

            document.getElementById('grossIncome').textContent = '‚Çπ ' + grossIncome.toLocaleString('en-IN');
            document.getElementById('totalDeductions').textContent = '‚Çπ ' + totalDeductions.toLocaleString('en-IN');
            document.getElementById('totalDeductionsDisplay').textContent = '‚Çπ ' + totalDeductions.toLocaleString('en-IN');
            document.getElementById('taxableIncome').textContent = '‚Çπ ' + taxableIncome.toLocaleString('en-IN');
            document.getElementById('taxOnIncome').textContent = '‚Çπ ' + Math.round(taxOnIncome).toLocaleString('en-IN');
            document.getElementById('healthCess').textContent = '‚Çπ ' + Math.round(healthCess).toLocaleString('en-IN');
            document.getElementById('totalTaxLiability').textContent = '‚Çπ ' + Math.round(totalTax).toLocaleString('en-IN');

            generateAdvanceTaxSchedule(totalTax);
            updateAdvanceTaxAdvice(totalTax, taxableIncome);
            updateSummaryStats(grossIncome, totalTax, totalDeductions, taxableIncome);
        }

        function generateAdvanceTaxSchedule(totalTax) {
            const tbody = document.getElementById('advanceTaxSchedule');
            const installments = [
                { name: '1st Installment', date: '15 Jun', percentage: 0.30 },
                { name: '2nd Installment', date: '15 Sep', percentage: 0.30 },
                { name: '3rd Installment', date: '15 Dec', percentage: 0.20 },
                { name: '4th Installment', date: '15 Mar', percentage: 0.20 }
            ];

            let cumulative = 0;
            tbody.innerHTML = installments.map(inst => {
                const amount = totalTax * inst.percentage;
                cumulative += amount;
                const status = new Date() > new Date('2025-' + (parseInt(inst.date.split(' ')[1]) - 1) + '-15') ? '‚úì Due' : '‚è≥ Pending';
                
                return `
                    <tr>
                        <td>${inst.name}</td>
                        <td>${inst.date}</td>
                        <td>${(inst.percentage * 100).toFixed(0)}%</td>
                        <td>‚Çπ ${Math.round(amount).toLocaleString('en-IN')}</td>
                        <td>‚Çπ ${Math.round(cumulative).toLocaleString('en-IN')}</td>
                        <td>${status}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateAdvanceTaxAdvice(totalTax, taxableIncome) {
            const advice = document.getElementById('advanceTaxAdvice');
            if (taxableIncome <= 300000) {
                advice.textContent = 'No advance tax payment required as your taxable income is below ‚Çπ 3,00,000.';
            } else {
                const q1 = Math.round(totalTax * 0.30);
                const q2 = Math.round(totalTax * 0.30);
                advice.innerHTML = `
                    <strong>Advance Tax Installments Recommended:</strong><br/>
                    ‚Ä¢ 1st Installment (15 Jun): ‚Çπ ${q1.toLocaleString('en-IN')}<br/>
                    ‚Ä¢ 2nd Installment (15 Sep): ‚Çπ ${q2.toLocaleString('en-IN')}<br/>
                    ‚Ä¢ 3rd & 4th Installments: See schedule below
                `;
            }
        }

        function updateSummaryStats(grossIncome, totalTax, totalDeductions, taxableIncome) {
            const effectiveTaxRate = grossIncome > 0 ? ((totalTax / grossIncome) * 100).toFixed(2) : 0;
            document.getElementById('summaryStats').innerHTML = `
                <div class="stat-card">
                    <h4>Gross Income</h4>
                    <div class="value">‚Çπ ${grossIncome.toLocaleString('en-IN')}</div>
                </div>
                <div class="stat-card">
                    <h4>Total Deductions</h4>
                    <div class="value">‚Çπ ${totalDeductions.toLocaleString('en-IN')}</div>
                </div>
                <div class="stat-card">
                    <h4>Projected Tax</h4>
                    <div class="value">‚Çπ ${Math.round(totalTax).toLocaleString('en-IN')}</div>
                </div>
                <div class="stat-card">
                    <h4>Effective Tax Rate</h4>
                    <div class="value">${effectiveTaxRate}%</div>
                </div>
            `;
        }

        function saveIncomeProjection() {
            const data = {
                fy: currentFY,
                salary: document.getElementById('salaryIncome').value,
                rental: document.getElementById('rentalIncome').value,
                interest: document.getElementById('interestIncome').value,
                dividend: document.getElementById('dividendIncome').value,
                capitalGains: document.getElementById('capitalGains').value,
                otherIncome: document.getElementById('otherIncome').value
            };
            localStorage.setItem('taxForecastingIncome_' + currentFY, JSON.stringify(data));
            alert('Income projection saved for ' + currentFY);
        }

        function saveDeductions() {
            const data = {
                fy: currentFY,
                section80C: document.getElementById('section80C').value,
                section80D: document.getElementById('section80D').value,
                section80E: document.getElementById('section80E').value,
                section24: document.getElementById('section24').value,
                section80TTA: document.getElementById('section80TTA').value,
                otherDeductions: document.getElementById('otherDeductions').value
            };
            localStorage.setItem('taxForecastingDeductions_' + currentFY, JSON.stringify(data));
            alert('Deductions saved for ' + currentFY);
        }

        function saveTaxCalculation() {
            saveIncomeProjection();
            saveDeductions();
            alert('Tax calculation saved for ' + currentFY);
        }

        function loadProjectionData() {
            const incomeData = JSON.parse(localStorage.getItem('taxForecastingIncome_' + currentFY) || '{}');
            const deductionData = JSON.parse(localStorage.getItem('taxForecastingDeductions_' + currentFY) || '{}');

            document.getElementById('salaryIncome').value = incomeData.salary || '';
            document.getElementById('rentalIncome').value = incomeData.rental || '';
            document.getElementById('interestIncome').value = incomeData.interest || '';
            document.getElementById('dividendIncome').value = incomeData.dividend || '';
            document.getElementById('capitalGains').value = incomeData.capitalGains || '';
            document.getElementById('otherIncome').value = incomeData.otherIncome || '';

            document.getElementById('section80C').value = deductionData.section80C || '';
            document.getElementById('section80D').value = deductionData.section80D || '';
            document.getElementById('section80E').value = deductionData.section80E || '';
            document.getElementById('section24').value = deductionData.section24 || '';
            document.getElementById('section80TTA').value = deductionData.section80TTA || '';
            document.getElementById('otherDeductions').value = deductionData.otherDeductions || '';

            updateTaxCalculation();
        }

        window.addEventListener('load', function() {
            const fontScale = localStorage.getItem('fontScale') || '0.95';
            document.documentElement.style.setProperty('--font-scale', fontScale);
            document.body.style.zoom = fontScale;
            loadProjectionData();
        });
    </script>
</body>
</html>
