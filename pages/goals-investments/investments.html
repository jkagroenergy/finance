<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Investments | FinCent</title>
    <script src="../../js/common.js"></script>
    <script src="../../numberToWords.js"></script>

    <style>
        :root {
            /* Revised purple color scheme from index.html */
            --brand-purple-1: #5b3bd6; /* deep */
            --brand-purple-2: #7b5cf2; /* mid */
            --brand-purple-3: #8b6ff8; /* light */
            --accent-green: #1fc08b;

            /* Semantic aliases */
            --primary: var(--brand-purple-2);
            --primary-light: var(--brand-purple-3);
            --primary-dark: var(--brand-purple-1);
            --secondary: #0f172a;
            --success: #10b981;
            --danger: #dc2626;
            --warning: #f59e0b;
            --light: #f8fafc;
            --card: #ffffff;
            --font-scale: 0.95;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", sans-serif;
        }

        body {
            background: var(--light);
            color: var(--secondary);
            padding: 30px;
        }

        .page-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header h1 {
            font-size: 28px;
            color: var(--primary);
            margin: 0;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: var(--secondary);
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            padding: 6px 12px;
            font-size: 12px;
            margin: 0 4px;
        }

        .content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th {
            background: #f1f5f9;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--secondary);
            border-bottom: 2px solid #e2e8f0;
            font-size: 13px;
        }

        .table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
        }

        .table tr:hover {
            background: #f8fafc;
        }

        .action-btn {
            padding: 6px 12px;
            margin: 0 4px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 650px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .modal-header h2 {
            color: var(--primary);
            font-size: 20px;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #94a3b8;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: #dbeafe;
            color: #1e40af;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .summary-card {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }

        .summary-card h4 {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 8px;
        }

        .summary-card .value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .table {
                font-size: 11px;
            }

            .table th, .table td {
                padding: 8px;
            }
        }

        /* Breadcrumb Styling */
        .entity-breadcrumb { background: linear-gradient(135deg, #f0f4ff 0%, #f5f3ff 100%); border: 1px solid #e0d8f5; border-radius: 8px; padding: 12px 16px; margin-bottom: 25px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; width: 100%; box-sizing: border-box; }
        .breadcrumb-label { font-size: 13px; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }
        .breadcrumb-entity-name { font-size: 16px; font-weight: 700; color: var(--primary); }
        .breadcrumb-entity-type { background: #e9e5ff; color: #6d28d9; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
    </style>
</head>
<body>
    <div class="page-header">
        <h1>Investments</h1>
        <button class="btn btn-primary" onclick="openAddInvestmentModal()">+ Add Investment</button>
    </div>

    <!-- Entity Breadcrumb -->
    <div class="entity-breadcrumb" id="entityBreadcrumb" style="display: none;">
        <span class="breadcrumb-label">Viewing:</span>
        <span class="breadcrumb-entity-name" id="breadcrumbEntityName"></span>
        <span class="breadcrumb-entity-type" id="breadcrumbEntityType"></span>
    </div>

    <div class="content">
        <h3 style="margin-bottom: 20px; color: var(--primary);">My Investments</h3>
        
        <div class="summary-cards" id="summaryCells"></div>

        <table class="table">
            <thead>
                <tr>
                    <th>Investment Type</th>
                    <th>Description</th>
                    <th>Invested Amount (â‚¹)</th>
                    <th>Expected Return (â‚¹)</th>
                    <th>Maturity Date</th>
                    <th>Expected Return %</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="investmentsTableBody">
                <tr>
                    <td colspan="7" class="empty-state">
                        <div class="empty-state-icon">ðŸ“ˆ</div>
                        <p>No investments added yet. Click "Add Investment" to record your investments.</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Add/Edit Investment Modal -->
    <div class="modal" id="investmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Investment</h2>
                <button class="modal-close" onclick="closeInvestmentModal()">Ã—</button>
            </div>

            <div class="form-group">
                <label for="investmentType">Investment Type *</label>
                <select id="investmentType">
                    <option value="">-- Select Investment Type --</option>
                    <optgroup label="Mutual Funds">
                        <option value="mf_equity">Equity Mutual Fund</option>
                        <option value="mf_debt">Debt Mutual Fund</option>
                        <option value="mf_balanced">Balanced Mutual Fund</option>
                        <option value="mf_liquid">Liquid Mutual Fund</option>
                    </optgroup>
                    <optgroup label="Fixed Income">
                        <option value="fd">Fixed Deposit (FD)</option>
                        <option value="rd">Recurring Deposit (RD)</option>
                        <option value="govt_bonds">Government Bonds</option>
                        <option value="ncd">Non-Convertible Debentures</option>
                    </optgroup>
                    <optgroup label="Equity">
                        <option value="stocks">Stocks / Shares</option>
                        <option value="ipo">IPO</option>
                    </optgroup>
                    <optgroup label="Retirement & Insurance">
                        <option value="nps">National Pension Scheme (NPS)</option>
                        <option value="ppf">Public Provident Fund (PPF)</option>
                        <option value="ulip">ULIP (Unit Linked Insurance Plan)</option>
                        <option value="life_insurance">Life Insurance</option>
                    </optgroup>
                    <optgroup label="Other">
                        <option value="gold">Gold / Jewellery</option>
                        <option value="savings_account">Savings Account</option>
                        <option value="crypto">Cryptocurrency</option>
                        <option value="p2p">P2P Lending</option>
                        <option value="other">Other</option>
                    </optgroup>
                </select>
            </div>

            <div class="form-group">
                <label for="description">Description / Details *</label>
                <textarea id="description" placeholder="e.g., HDFC Growth Fund / ICICI Bank FD / TCS Stocks"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="investedAmount">Invested Amount (â‚¹) *</label>
                    <input type="number" id="investedAmount" placeholder="0.00" min="0" step="0.01" />
                </div>

                <div class="form-group">
                    <label for="expectedReturn">Expected Return / Maturity Amount (â‚¹) *</label>
                    <input type="number" id="expectedReturn" placeholder="0.00" min="0" step="0.01" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="expectedReturnPercent">Expected Return % *</label>
                    <input type="number" id="expectedReturnPercent" placeholder="0.00" min="0" step="0.01" />
                </div>

                <div class="form-group">
                    <label for="maturityDate">Maturity Date / Expected Return Date *</label>
                    <input type="date" id="maturityDate" />
                </div>
            </div>

            <div class="form-group">
                <label for="investmentNotes">Notes</label>
                <textarea id="investmentNotes" placeholder="Add any relevant notes about this investment"></textarea>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveInvestment()">Save Investment</button>
                <button class="btn btn-secondary" onclick="closeInvestmentModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let currentEditingId = null;

        function openAddInvestmentModal() {
            currentEditingId = null;
            document.getElementById('modalTitle').textContent = 'Add Investment';
            document.getElementById('investmentType').value = '';
            document.getElementById('description').value = '';
            document.getElementById('investedAmount').value = '';
            document.getElementById('expectedReturn').value = '';
            document.getElementById('expectedReturnPercent').value = '';
            document.getElementById('maturityDate').value = '';
            document.getElementById('investmentNotes').value = '';
            document.getElementById('investmentModal').classList.add('active');
        }

        function closeInvestmentModal() {
            document.getElementById('investmentModal').classList.remove('active');
        }

        function saveInvestment() {
            const investmentType = document.getElementById('investmentType').value;
            const description = document.getElementById('description').value.trim();
            const investedAmount = document.getElementById('investedAmount').value;
            const expectedReturn = document.getElementById('expectedReturn').value;
            const expectedReturnPercent = document.getElementById('expectedReturnPercent').value;
            const maturityDate = document.getElementById('maturityDate').value;
            const investmentNotes = document.getElementById('investmentNotes').value;

            if (!investmentType || !description || !investedAmount || !expectedReturn || !expectedReturnPercent || !maturityDate) {
                alert('Please fill in all required fields');
                return;
            }

            const investment = {
                id: currentEditingId || Date.now(),
                type: investmentType,
                description: description,
                investedAmount: parseFloat(investedAmount),
                expectedReturn: parseFloat(expectedReturn),
                expectedReturnPercent: parseFloat(expectedReturnPercent),
                maturityDate: maturityDate,
                notes: investmentNotes,
                createdDate: currentEditingId ? null : new Date().toISOString()
            };

            let investments = JSON.parse(localStorage.getItem('investments') || '[]');

            if (currentEditingId) {
                investments = investments.map(inv => inv.id === currentEditingId ? investment : inv);
            } else {
                investments.push(investment);
            }

            localStorage.setItem('investments', JSON.stringify(investments));
            loadInvestments();
            updateSummary();
            closeInvestmentModal();
            alert('Investment saved successfully!');
        }

        function updateBreadcrumb() {
            const selectedEntityId = localStorage.getItem('selectedEntity');
            const breadcrumb = document.getElementById('entityBreadcrumb');
            
            if (selectedEntityId && breadcrumb) {
                const entities = JSON.parse(localStorage.getItem('fincentEntities') || '[]');
                const selectedEntity = entities.find(e => e.id === selectedEntityId);
                
                if (selectedEntity) {
                    const entityNameEl = document.getElementById('breadcrumbEntityName');
                    const entityTypeEl = document.getElementById('breadcrumbEntityType');
                    
                    if (entityNameEl && entityTypeEl) {
                        entityNameEl.textContent = selectedEntity.name;
                        entityTypeEl.textContent = getEntityTypeLabel(selectedEntity.type);
                        breadcrumb.style.display = 'flex';
                    }
                }
            }
        }

        function loadInvestments() {
            updateBreadcrumb();
            const investments = JSON.parse(localStorage.getItem('investments') || '[]');
            const tbody = document.getElementById('investmentsTableBody');

            if (investments.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-state-icon">ðŸ“ˆ</div>
                            <p>No investments added yet. Click "Add Investment" to record your investments.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            const typeLabels = {
                'mf_equity': 'Equity Mutual Fund',
                'mf_debt': 'Debt Mutual Fund',
                'mf_balanced': 'Balanced Mutual Fund',
                'mf_liquid': 'Liquid Mutual Fund',
                'fd': 'Fixed Deposit',
                'rd': 'Recurring Deposit',
                'govt_bonds': 'Government Bonds',
                'ncd': 'Non-Convertible Debentures',
                'stocks': 'Stocks',
                'ipo': 'IPO',
                'nps': 'NPS',
                'ppf': 'PPF',
                'ulip': 'ULIP',
                'life_insurance': 'Life Insurance',
                'gold': 'Gold',
                'savings_account': 'Savings Account',
                'crypto': 'Cryptocurrency',
                'p2p': 'P2P Lending',
                'other': 'Other'
            };

            tbody.innerHTML = investments.map((inv, idx) => `
                <tr>
                    <td><span class="badge">${typeLabels[inv.type] || inv.type}</span></td>
                    <td>${inv.description}</td>
                    <td>â‚¹ ${parseFloat(inv.investedAmount).toLocaleString('en-IN')}</td>
                    <td>â‚¹ ${parseFloat(inv.expectedReturn).toLocaleString('en-IN')}</td>
                    <td>${new Date(inv.maturityDate).toLocaleDateString('en-IN')}</td>
                    <td>${inv.expectedReturnPercent}%</td>
                    <td>
                        <button class="btn btn-primary action-btn" onclick="editInvestment(${idx})">Edit</button>
                        <button class="btn btn-danger action-btn" onclick="deleteInvestment(${idx})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateSummary() {
            const investments = JSON.parse(localStorage.getItem('investments') || '[]');
            const totalInvested = investments.reduce((sum, inv) => sum + inv.investedAmount, 0);
            const totalExpectedReturn = investments.reduce((sum, inv) => sum + inv.expectedReturn, 0);
            const totalProfit = totalExpectedReturn - totalInvested;

            document.getElementById('summaryCells').innerHTML = `
                <div class="summary-card">
                    <h4>Total Invested</h4>
                    <div class="value">â‚¹ ${totalInvested.toLocaleString('en-IN')}</div>
                </div>
                <div class="summary-card">
                    <h4>Expected Maturity Value</h4>
                    <div class="value">â‚¹ ${totalExpectedReturn.toLocaleString('en-IN')}</div>
                </div>
                <div class="summary-card">
                    <h4>Expected Profit</h4>
                    <div class="value">â‚¹ ${totalProfit.toLocaleString('en-IN')}</div>
                </div>
            `;
        }

        function editInvestment(idx) {
            const investments = JSON.parse(localStorage.getItem('investments') || '[]');
            const investment = investments[idx];

            currentEditingId = investment.id;
            document.getElementById('modalTitle').textContent = 'Edit Investment';
            document.getElementById('investmentType').value = investment.type;
            document.getElementById('description').value = investment.description;
            document.getElementById('investedAmount').value = investment.investedAmount;
            document.getElementById('expectedReturn').value = investment.expectedReturn;
            document.getElementById('expectedReturnPercent').value = investment.expectedReturnPercent;
            document.getElementById('maturityDate').value = investment.maturityDate;
            document.getElementById('investmentNotes').value = investment.notes || '';

            document.getElementById('investmentModal').classList.add('active');
        }

        function deleteInvestment(idx) {
            if (confirm('Are you sure you want to delete this investment?')) {
                let investments = JSON.parse(localStorage.getItem('investments') || '[]');
                investments.splice(idx, 1);
                localStorage.setItem('investments', JSON.stringify(investments));
                loadInvestments();
                updateSummary();
            }
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            const fontScale = localStorage.getItem('fontScale') || '0.95';
            document.documentElement.style.setProperty('--font-scale', fontScale);
            document.body.style.zoom = fontScale;
            loadInvestments();
            updateSummary();
        });
    </script>
</body>
</html>
